{
  "Name": "工事見積会社コピー処理",
  "Enabled": true,
  "Triggers": [
    {
      "$type": "Forguncy.SaveLoad.PostRequestTriggerSaveData, ServerDesignerCommon",
      "Permission": {
        "PermissionData": {
          "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionData, Forguncy.RbacPermission.Core",
          "permissionResource": {
            "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionResource, Forguncy.RbacPermission.Core"
          },
          "permissionBindings": [
            {
              "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionBinding, Forguncy.RbacPermission.Core",
              "roleNames": [
                "FGC_LoginUser"
              ]
            }
          ]
        }
      },
      "Parameters": [
        {
          "Name": "P_申込ID",
          "DataValidationInfo": {}
        },
        {
          "Type": 1,
          "ArrayParamItems": [
            {
              "Name": "P_選択フラグ",
              "DataValidationInfo": {}
            },
            {
              "Name": "P_物件ID",
              "DataValidationInfo": {}
            }
          ],
          "Name": "P_物件リスト",
          "DataValidationInfo": {}
        }
      ]
    }
  ],
  "Commands": [
    {
      "$type": "Forguncy.Model.ServerTransactionCommand, ServerDesignerCommon",
      "CommandList": [
        {
          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
          "ParameterName": "申込情報",
          "TableValue": {
            "TableName": "t_object_order",
            "TableValueType": 1,
            "BindingInfos": [
              {
                "GUID": "1658c5b2-faf9-48a5-9672-07c3091f1872",
                "BindingInfo": {
                  "TableName": "t_object_order",
                  "ColumnName": "latest_construction_id",
                  "GUID": "e35efc3a-701d-4564-966a-3f507eb0593c"
                },
                "ColumnName": "最新工事ID"
              },
              {
                "GUID": "0ca4d668-20b2-4248-93c5-87181c1b8f6a",
                "BindingInfo": {
                  "TableName": "t_object_order",
                  "ColumnName": "group_id",
                  "GUID": "f544367c-4c87-43c6-be3f-0a6d8fb00c43"
                },
                "ColumnName": "申込グループID"
              },
              {
                "GUID": "e3ffaf78-6988-4a21-8fbb-093fec901593",
                "BindingInfo": {
                  "TableName": "t_object_order",
                  "ColumnName": "builder_id",
                  "GUID": "392e8409-bcbf-4c49-b95f-0d368bbc1bd2"
                },
                "ColumnName": "住宅事業者ID"
              },
              {
                "GUID": "edede0e0-dd4f-4a0a-9cb1-9062317fed99",
                "BindingInfo": {
                  "TableName": "t_object_order",
                  "ColumnName": "latest_analysis_id",
                  "GUID": "106d9657-a8ac-4abb-b6bd-69b355191531",
                  "RelationBinding": {
                    "RelatedTable": "t_object_analysis",
                    "RelatedColumn": "analysis_id",
                    "DisplayColumn": "analysis_complete_date"
                  }
                },
                "ColumnName": "解析確定日"
              }
            ],
            "SqlCondition": {
              "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
              "ColumnBindingInfo": {
                "TableName": "t_object_order",
                "ColumnName": "object_id",
                "GUID": "ff20fe31-b609-4baf-aa3e-9e5611d075b4"
              },
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=P_申込ID"
              }
            },
            "TopCount": "1",
            "OrderBySqlCondition": {
              "OrderByColumns": [
                {
                  "ColumnBindingInfo": {
                    "TableName": "t_object_order",
                    "ColumnName": "object_order_id",
                    "GUID": "d729d1df-4839-40e0-be78-08d3007e0caf"
                  },
                  "Order": 1
                }
              ]
            }
          },
          "ID": "3526ee6385ff4f1ebff53f50d70dbe8c"
        },
        {
          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
          "ParameterName": "工事見積業者",
          "TableValue": {
            "TableName": "t_object_construction_estimate",
            "BindingInfos": [
              {
                "GUID": "7dae9280-26fd-444a-8ea3-70f9cd29e024",
                "BindingInfo": {
                  "TableName": "t_object_construction_estimate",
                  "ColumnName": "construction_customer_id",
                  "GUID": "c4d390c1-057d-4fdc-80f3-8d67b91d4fa0"
                },
                "ColumnName": "工事会社ID"
              },
              {
                "GUID": "6ae42c48-9214-439d-926f-977992344ca9",
                "BindingInfo": {
                  "TableName": "t_object_construction_estimate",
                  "ColumnName": "priority_type_id",
                  "GUID": "fa443788-8920-4824-a8d3-96780b43166a"
                },
                "ColumnName": "優先度ID"
              },
              {
                "GUID": "a6c0290b-2afb-435c-8fc8-6ee2ca5f0eb5",
                "BindingInfo": {
                  "TableName": "t_object_construction_estimate",
                  "ColumnName": "object_order_id",
                  "GUID": "f2785968-a897-4ec6-9283-f1132066d876",
                  "RelationBinding": {
                    "RelatedTable": "t_object_order",
                    "RelatedColumn": "object_order_id",
                    "DisplayColumn": "latest_construction_id",
                    "NextRelationBinding": {
                      "RelatedTable": "t_object_construction",
                      "RelatedColumn": "construction_id",
                      "DisplayColumn": "estimate_urgent_flg"
                    }
                  }
                },
                "ColumnName": "見積至急フラグ"
              }
            ],
            "SqlCondition": {
              "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
              "ColumnBindingInfo": {
                "TableName": "t_object_construction_estimate",
                "ColumnName": "object_order_id",
                "GUID": "aec6b901-20d9-41eb-8958-ef399cbdb40e"
              },
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=P_申込ID"
              }
            }
          },
          "ID": "39fc3ba4feab46e8a32be2ee3ec14484"
        },
        {
          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
          "ParameterName": "工事見積初期ST",
          "TableValue": {
            "TableName": "m_construction_estimate_status",
            "OnlyGetValue": true,
            "TableValueType": 0,
            "BindingInfos": [
              {
                "GUID": "645f17a4-534a-4dea-a207-a9553ee89d01",
                "BindingInfo": {
                  "TableName": "m_construction_estimate_status",
                  "ColumnName": "construction_estimate_status_id",
                  "GUID": "e58dc20b-f835-46af-b246-32c26cca0159"
                },
                "ColumnName": "construction_estimate_status_id"
              }
            ],
            "SqlCondition": {
              "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
              "ColumnBindingInfo": {
                "TableName": "m_construction_estimate_status",
                "ColumnName": "estimate_arrange_wait_flg",
                "GUID": "070bae23-b985-4bdd-87a4-6cb92546f0b1"
              },
              "Value": "1"
            }
          },
          "ID": "3389d60f4217410787d15189a39187c8"
        },
        {
          "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
          "ServerCommandName": "登録更新ラベル取得",
          "Parameters": [
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_ユーザーID"
            }
          ],
          "ResultErrorCodeTo": {
            "SerializeProperty": "リターンコード"
          },
          "ResultMessageTo": {
            "SerializeProperty": "リターンメッセージ"
          },
          "ReturnPropertiesTo": [
            {
              "ResultPropertyName": "R_ラベル名",
              "ResultTo": {
                "SerializeProperty": "最終更新ラベル"
              }
            },
            {
              "ResultPropertyName": "R_外部ユーザーフラグ"
            }
          ],
          "RefreshAfterFinish": true,
          "CheckDataValidation": true
        },
        {
          "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
          "ConditionAndCommandPairList": [
            {
              "Condition": {
                "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                "param": {
                  "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                  "ParamObject": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=申込情報.最新工事ID"
                  }
                },
                "value": "%Null%"
              },
              "CommandList": [
                {
                  "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                  "ParameterName": "工事請負フラグ",
                  "TableValue": {
                    "TableName": "v_group_customer_default",
                    "OnlyGetValue": true,
                    "TableValueType": 0,
                    "BindingInfos": [
                      {
                        "GUID": "757d9de4-ec4f-4dc2-853c-a97c76bd7920",
                        "BindingInfo": {
                          "TableName": "v_group_customer_default",
                          "ColumnName": "工事請負フラグ",
                          "GUID": "5e691492-ca79-42c3-b5d4-70b575d8621c"
                        },
                        "ColumnName": "工事請負フラグ"
                      }
                    ],
                    "SqlCondition": {
                      "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                      "SubConditions": [
                        {
                          "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                          "ColumnBindingInfo": {
                            "TableName": "v_group_customer_default",
                            "ColumnName": "グループID",
                            "GUID": "9a5bc8b6-e1c4-46b7-8c9b-bc9fc8648de7"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=申込情報.申込グループID"
                          }
                        },
                        {
                          "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                          "ColumnBindingInfo": {
                            "TableName": "v_group_customer_default",
                            "ColumnName": "顧客ID",
                            "GUID": "5e0d6ce6-acfb-448b-9d7e-7c7c273c260a"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=申込情報.住宅事業者ID"
                          }
                        }
                      ]
                    },
                    "NullFormulaValueQueryPolicy": 0
                  },
                  "ID": "2bee1b4b4dbf4e8a914d18224b7f7f65"
                },
                {
                  "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
                  "ServerCommandName": "見積送付期限日取得",
                  "Parameters": [
                    {
                      "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
                      "ParamName": "P_解析確定日",
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=申込情報.解析確定日"
                      }
                    }
                  ],
                  "ReturnPropertiesTo": [
                    {
                      "ResultPropertyName": "R_見積送付期限日",
                      "ResultTo": {
                        "SerializeProperty": "V_見積送付期限日"
                      }
                    }
                  ],
                  "RefreshAfterFinish": true,
                  "CheckDataValidation": true
                },
                {
                  "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                  "TableName": "t_object_construction",
                  "UpdateType": "add",
                  "ShowConfirm": false,
                  "UpdateBindingValues": [
                    {
                      "BindingInfo": {
                        "TableName": "t_object_construction",
                        "ColumnName": "object_order_id",
                        "GUID": "53d0500c-0b9c-42b1-909b-53d436786575"
                      },
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=P_申込ID"
                      }
                    },
                    {
                      "BindingInfo": {
                        "TableName": "t_object_construction",
                        "ColumnName": "construction_register_date",
                        "GUID": "cab8b2f9-f9b3-45ed-8b61-1cd435e4a799"
                      },
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=TODAY()"
                      }
                    },
                    {
                      "BindingInfo": {
                        "TableName": "t_object_construction",
                        "ColumnName": "estimate_send_period_date",
                        "GUID": "dffdde3f-c5a0-4ff5-9a3a-bdf0404664c5"
                      },
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=V_見積送付期限日"
                      }
                    },
                    {
                      "BindingInfo": {
                        "TableName": "t_object_construction",
                        "ColumnName": "construction_type",
                        "GUID": "0a8f5499-b160-4cab-b0a2-03717eb7a6f1"
                      },
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=IF(工事請負フラグ=1,1,2)"
                      }
                    }
                  ],
                  "ParamNameToSaveNewRowValue": "New工事情報"
                },
                {
                  "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                  "TableName": "t_object_order",
                  "ShowConfirm": false,
                  "RowsToUpdate": 1,
                  "RowsToUpdateCondition": {
                    "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                    "ColumnBindingInfo": {
                      "TableName": "t_object_order",
                      "ColumnName": "object_order_id",
                      "GUID": "f1a3e95f-d6ec-422c-8d3d-3275ce167aab"
                    },
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=Item_工事会社.申込ID"
                    }
                  },
                  "UpdateBindingValues": [
                    {
                      "BindingInfo": {
                        "TableName": "t_object_order",
                        "ColumnName": "latest_construction_id",
                        "GUID": "b383d72d-48af-4db5-8988-d53afecb6bd3"
                      },
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=New工事情報.工事ID"
                      }
                    }
                  ]
                },
                {
                  "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
                  "ServerCommandName": "工事見積最大ステータス更新処理",
                  "Parameters": [
                    {
                      "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
                      "ParamName": "P_申込ID",
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=P_申込ID"
                      }
                    },
                    {
                      "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
                      "ParamName": "P_工事ID",
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=New工事情報.工事ID"
                      }
                    },
                    {
                      "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
                      "ParamName": "P_工事完了フラグ"
                    }
                  ],
                  "ReturnPropertiesTo": [
                    {
                      "ResultPropertyName": "R_有効見積業者数"
                    }
                  ],
                  "RefreshAfterFinish": true,
                  "CheckDataValidation": true
                }
              ],
              "ID": "4e6b54de-e5dd-4bac-8b5f-19f5a1ac75df"
            }
          ]
        },
        {
          "$type": "Forguncy.Model.LoopCommand, ServerDesignerCommon",
          "LoopInfo": {
            "$type": "Forguncy.Model.CountLoopInfo, ServerDesignerCommon",
            "LoopCount": {
              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
              "SerializeProperty": "=P_物件リスト"
            },
            "LoopItemParamName": "Item_対象物件"
          },
          "CommandList": [
            {
              "$type": "Forguncy.Model.LoopCommand, ServerDesignerCommon",
              "LoopInfo": {
                "$type": "Forguncy.Model.CountLoopInfo, ServerDesignerCommon",
                "LoopCount": {
                  "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                  "SerializeProperty": "=工事見積業者"
                },
                "LoopItemParamName": "Item_工事会社"
              },
              "CommandList": [
                {
                  "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
                  "ConditionAndCommandPairList": [
                    {
                      "Condition": {
                        "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                        "param": {
                          "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                          "ParamObject": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=Item_対象物件.P_選択フラグ"
                          }
                        },
                        "value": "1"
                      },
                      "CommandList": [
                        {
                          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                          "ParameterName": "登録済み件数",
                          "TableValue": {
                            "TableName": "t_object_construction_estimate",
                            "TableValueType": 3,
                            "SqlCondition": {
                              "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                              "SubConditions": [
                                {
                                  "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                                  "ColumnBindingInfo": {
                                    "TableName": "t_object_construction_estimate",
                                    "ColumnName": "object_order_id",
                                    "GUID": "abfcae46-ec5a-4f28-bca1-58ad017c2bbc"
                                  },
                                  "Value": {
                                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                    "SerializeProperty": "=P_申込ID"
                                  }
                                },
                                {
                                  "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                                  "ColumnBindingInfo": {
                                    "TableName": "t_object_construction_estimate",
                                    "ColumnName": "construction_customer_id",
                                    "GUID": "bc845b91-52c5-4c1d-be8e-ff1e0f6de353"
                                  },
                                  "Value": {
                                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                    "SerializeProperty": "=Item_工事会社.工事会社ID"
                                  }
                                }
                              ]
                            }
                          },
                          "ID": "adc171fdb5664cbe94b73e100d8488a6"
                        },
                        {
                          "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
                          "ConditionAndCommandPairList": [
                            {
                              "Condition": {
                                "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                                "param": {
                                  "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                                  "ParamObject": {
                                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                    "SerializeProperty": "=登録済み件数"
                                  }
                                },
                                "value": "0"
                              },
                              "CommandList": [
                                {
                                  "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                                  "TableName": "t_object_construction_estimate",
                                  "UpdateType": "add",
                                  "ShowConfirm": false,
                                  "UpdateBindingValues": [
                                    {
                                      "BindingInfo": {
                                        "TableName": "t_object_construction_estimate",
                                        "ColumnName": "construction_estimate_register_date",
                                        "GUID": "7b1594ab-91dd-476f-994c-c605c8848e39"
                                      },
                                      "Value": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=TODAY()"
                                      }
                                    },
                                    {
                                      "BindingInfo": {
                                        "TableName": "t_object_construction_estimate",
                                        "ColumnName": "object_order_id",
                                        "GUID": "b7ddcab9-08e5-4bbf-abd0-81bce169e967"
                                      },
                                      "Value": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=P_申込ID"
                                      }
                                    },
                                    {
                                      "BindingInfo": {
                                        "TableName": "t_object_construction_estimate",
                                        "ColumnName": "construction_customer_id",
                                        "GUID": "59f4eaed-a21f-4198-9fe3-6f49237a2dec"
                                      },
                                      "Value": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=Item_工事会社.工事会社ID"
                                      }
                                    },
                                    {
                                      "BindingInfo": {
                                        "TableName": "t_object_construction_estimate",
                                        "ColumnName": "priority_type_id",
                                        "GUID": "e644eacf-10e3-4c32-977c-3b2128f7d24f"
                                      },
                                      "Value": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=Item_工事会社.優先度ID"
                                      }
                                    },
                                    {
                                      "BindingInfo": {
                                        "TableName": "t_object_construction_estimate",
                                        "ColumnName": "estimate_urgent_flg",
                                        "GUID": "067877a2-e3e1-4f8a-be2a-eb32a0261a6b"
                                      },
                                      "Value": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=Item_工事会社.見積至急フラグ"
                                      }
                                    },
                                    {
                                      "BindingInfo": {
                                        "TableName": "t_object_construction_estimate",
                                        "ColumnName": "construction_estimate_status_id",
                                        "GUID": "51ea3de1-9ae6-4d49-a59d-91275b21ec8e"
                                      },
                                      "Value": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=工事見積初期ST"
                                      }
                                    },
                                    {
                                      "BindingInfo": {
                                        "TableName": "t_object_construction_estimate",
                                        "ColumnName": "last_updated_label",
                                        "GUID": "b1c2753d-a39b-45c9-b777-47f0db61fa76"
                                      },
                                      "Value": {
                                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                        "SerializeProperty": "=最終更新ラベル"
                                      }
                                    }
                                  ]
                                }
                              ],
                              "ID": "5ce451d8-3e0a-44f3-99e3-c99fa2a6f7ba"
                            }
                          ]
                        }
                      ],
                      "ID": "bdbfc787-cd9e-4f8c-a19a-f4dc906e3d2d"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
          "ErrorCode": "0"
        }
      ]
    }
  ]
}