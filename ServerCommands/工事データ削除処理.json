{
  "Name": "工事データ削除処理",
  "Enabled": true,
  "Triggers": [
    {
      "$type": "Forguncy.SaveLoad.PostRequestTriggerSaveData, ServerDesignerCommon",
      "Permission": {
        "PermissionData": {
          "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionData, Forguncy.RbacPermission.Core",
          "permissionResource": {
            "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionResource, Forguncy.RbacPermission.Core"
          },
          "permissionBindings": [
            {
              "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionBinding, Forguncy.RbacPermission.Core",
              "roleNames": [
                "FGC_LoginUser"
              ]
            }
          ]
        }
      },
      "Parameters": [
        {
          "Name": "P_申込ID",
          "DataValidationInfo": {}
        },
        {
          "Name": "P_工事ID",
          "DataValidationInfo": {}
        }
      ]
    }
  ],
  "Commands": [
    {
      "$type": "Forguncy.Model.ServerTransactionCommand, ServerDesignerCommon",
      "CommandList": [
        {
          "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
          "TableName": "t_object_construction",
          "UpdateType": "delete",
          "ShowConfirm": true,
          "ConfirmText": "本当に削除してもよろしいですか？",
          "RowsToUpdate": 1,
          "RowsToUpdateCondition": {
            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
            "ColumnBindingInfo": {
              "TableName": "t_object_construction",
              "ColumnName": "construction_id",
              "GUID": "264f404d-0ccd-4de2-853c-1aaba52a2354"
            },
            "Value": {
              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
              "SerializeProperty": "=P_工事ID"
            }
          }
        },
        {
          "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
          "TableName": "t_object_product",
          "UpdateType": "delete",
          "ShowConfirm": true,
          "ConfirmText": "本当に削除してもよろしいですか？",
          "RowsToUpdate": 1,
          "RowsToUpdateCondition": {
            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
            "ColumnBindingInfo": {
              "TableName": "t_object_product",
              "ColumnName": "construction_id",
              "GUID": "9678eae4-8f60-4920-8aad-97aaf592d097"
            },
            "Value": {
              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
              "SerializeProperty": "=P_工事ID"
            }
          }
        },
        {
          "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
          "ServerCommandName": "工事後発履歴更新処理",
          "Parameters": [
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_申込ID",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=P_申込ID"
              }
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_工事ID",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=P_工事ID"
              }
            }
          ],
          "RefreshAfterFinish": true,
          "CheckDataValidation": true
        },
        {
          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
          "ParameterName": "最新工事情報",
          "TableValue": {
            "TableName": "t_object_construction",
            "TableValueType": 1,
            "BindingInfos": [
              {
                "GUID": "422417ce-95ca-4bda-b621-de76922d87ac",
                "BindingInfo": {
                  "TableName": "t_object_construction",
                  "ColumnName": "construction_id",
                  "GUID": "acdbd8f7-e293-4443-9a64-12463ad8881a"
                },
                "ColumnName": "工事ID"
              }
            ],
            "SqlCondition": {
              "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
              "ColumnBindingInfo": {
                "TableName": "t_object_construction",
                "ColumnName": "object_order_id",
                "GUID": "2fc785cf-60dd-4f50-8549-0771e025dd2a"
              },
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=P_申込ID"
              }
            },
            "TopCount": "1",
            "OrderBySqlCondition": {
              "OrderByColumns": [
                {
                  "ColumnBindingInfo": {
                    "TableName": "t_object_construction",
                    "ColumnName": "construction_id",
                    "GUID": "5ca46111-0dec-48ed-9aff-0ca7e9d72ea4"
                  },
                  "Order": 1
                }
              ]
            }
          },
          "ID": "dcd6f62f8886444e9e439029f9ab89eb"
        },
        {
          "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
          "TableName": "t_object_order",
          "ShowConfirm": false,
          "RowsToUpdate": 1,
          "RowsToUpdateCondition": {
            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
            "ColumnBindingInfo": {
              "TableName": "t_object_order",
              "ColumnName": "object_order_id",
              "GUID": "8b3af122-6d96-468e-9b07-d577475e9153"
            },
            "Value": {
              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
              "SerializeProperty": "=P_申込ID"
            }
          },
          "UpdateBindingValues": [
            {
              "BindingInfo": {
                "TableName": "t_object_order",
                "ColumnName": "latest_construction_id",
                "GUID": "18b4ccbe-4b2d-47c0-9b71-c3ff8b705791"
              },
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=最新工事情報.工事ID"
              }
            }
          ]
        },
        {
          "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
          "ConditionAndCommandPairList": [
            {
              "Condition": {
                "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                "param": {
                  "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                  "ParamObject": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=最新工事情報.工事ID"
                  }
                },
                "value": "%Null%"
              },
              "CommandList": [
                {
                  "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                  "ParameterName": "申込情報",
                  "TableValue": {
                    "TableName": "t_object_order",
                    "TableValueType": 1,
                    "BindingInfos": [
                      {
                        "GUID": "f3c3a255-17d0-445b-bfa6-008f495d355e",
                        "BindingInfo": {
                          "TableName": "t_object_order",
                          "ColumnName": "latest_warranty_id",
                          "GUID": "cb48d5ef-0eaa-4235-be8b-5d62b15d649c"
                        },
                        "ColumnName": "最新保証ID"
                      },
                      {
                        "GUID": "6612a7f5-19e7-49f4-b205-4823ddf7711c",
                        "BindingInfo": {
                          "TableName": "t_object_order",
                          "ColumnName": "latest_warranty_id",
                          "GUID": "e460bcd4-c3c8-47be-9164-92c5be6083ae",
                          "RelationBinding": {
                            "RelatedTable": "t_object_warranty",
                            "RelatedColumn": "warranty_id",
                            "DisplayColumn": "warranty_status_id",
                            "NextRelationBinding": {
                              "RelatedTable": "m_warranty_status",
                              "RelatedColumn": "warranty_status_id",
                              "DisplayColumn": "construction_result_waite_flg"
                            }
                          }
                        },
                        "ColumnName": "工事結果待ちフラグ"
                      }
                    ],
                    "SqlCondition": {
                      "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                      "ColumnBindingInfo": {
                        "TableName": "t_object_order",
                        "ColumnName": "object_order_id",
                        "GUID": "7de7627b-a4f3-43fe-9464-440b13def1df"
                      },
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=P_申込ID"
                      }
                    },
                    "NullFormulaValueQueryPolicy": 0
                  },
                  "ID": "1001ab6c8ff34538a2c4fb7243b7f803"
                },
                {
                  "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
                  "ConditionAndCommandPairList": [
                    {
                      "Condition": {
                        "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                        "param": {
                          "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                          "ParamObject": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=申込情報.工事結果待ちフラグ"
                          }
                        },
                        "value": "1"
                      },
                      "CommandList": [
                        {
                          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                          "ParameterName": "保証ST",
                          "TableValue": {
                            "TableName": "m_warranty_status",
                            "OnlyGetValue": true,
                            "TableValueType": 0,
                            "BindingInfos": [
                              {
                                "GUID": "6414e6dd-db87-4b26-aeb2-c7eb1ec0735f",
                                "BindingInfo": {
                                  "TableName": "m_warranty_status",
                                  "ColumnName": "warranty_status_id",
                                  "GUID": "af7771ac-f7c3-46ec-b9dc-7c692d572a3c"
                                },
                                "ColumnName": "warranty_status_id"
                              }
                            ],
                            "SqlCondition": {
                              "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                              "ColumnBindingInfo": {
                                "TableName": "m_warranty_status",
                                "ColumnName": "warranty_check_flg",
                                "GUID": "091ed8e9-2f3f-4e65-9fa7-228f3e4eb108"
                              },
                              "Value": "1"
                            }
                          },
                          "ID": "afdb989199cb46fc821422b444a735ad",
                          "Comments": "保証確認中"
                        },
                        {
                          "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                          "TableName": "t_object_warranty",
                          "ShowConfirm": false,
                          "RowsToUpdate": 1,
                          "RowsToUpdateCondition": {
                            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                            "ColumnBindingInfo": {
                              "TableName": "t_object_warranty",
                              "ColumnName": "warranty_id",
                              "GUID": "b6eaa6f3-5468-461c-a7f5-cd0f6eca7b51"
                            },
                            "Value": {
                              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                              "SerializeProperty": "=申込情報.最新保証ID"
                            }
                          },
                          "UpdateBindingValues": [
                            {
                              "BindingInfo": {
                                "TableName": "t_object_warranty",
                                "ColumnName": "warranty_status_id",
                                "GUID": "73d2c362-d737-4669-a14b-f44d3225ef80"
                              },
                              "Value": {
                                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                "SerializeProperty": "=保証ST"
                              }
                            }
                          ]
                        }
                      ],
                      "ID": "76d830f7-b853-44a1-91b3-df920f363a4b"
                    }
                  ]
                }
              ],
              "ID": "6e6db67d-cd57-44bf-a3a2-35a92939a9e5"
            }
          ]
        },
        {
          "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
          "ServerCommandName": "最新申込ステータス更新処理",
          "Parameters": [
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_申込ID",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=P_申込ID"
              }
            }
          ],
          "ResultErrorCodeTo": {
            "SerializeProperty": "リターンコード"
          },
          "ResultMessageTo": {
            "SerializeProperty": "リターンメッセージ"
          },
          "ReturnPropertiesTo": [
            {
              "ResultPropertyName": "R_申込ステータス更新フラグ"
            },
            {
              "ResultPropertyName": "R_更新済み申込ステータスID"
            }
          ],
          "RefreshAfterFinish": true,
          "CheckDataValidation": true
        }
      ]
    }
  ]
}