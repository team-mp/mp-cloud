{
  "Name": "保証確認リスト生成処理",
  "Enabled": true,
  "Triggers": [
    {
      "$type": "Forguncy.SaveLoad.InvokeTriggerSaveData, ServerDesignerCommon",
      "Parameters": [
        {
          "Name": "P_対象事業者ID",
          "DataValidationInfo": {}
        },
        {
          "Name": "P_対象事業者名",
          "DataValidationInfo": {}
        },
        {
          "Name": "P_ダウンロードフラグ",
          "DataValidationInfo": {}
        }
      ]
    }
  ],
  "Commands": [
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "エクスポートファイル名",
      "ParameterValue": {
        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
        "SerializeProperty": "=\"【保証書発行のご確認】\"&P_対象事業者名&\"様_\"&TEXT(TODAY(),\"yyyymmdd\")"
      },
      "ID": "050e383ef33f49a6957d43ec5cd1f08e"
    },
    {
      "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
      "ServerCommandName": "ファイル名文字列変換",
      "Parameters": [
        {
          "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
          "ParamName": "P_変換元文字列",
          "Value": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=エクスポートファイル名"
          }
        }
      ],
      "ReturnPropertiesTo": [
        {
          "ResultPropertyName": "R_変換後文字列",
          "ResultTo": {
            "SerializeProperty": "エクスポートファイル名"
          }
        }
      ],
      "RefreshAfterFinish": true,
      "CheckDataValidation": true
    },
    {
      "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
      "ConditionAndCommandPairList": [
        {
          "Condition": {
            "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
            "param": {
              "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
              "ParamObject": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=P_ダウンロードフラグ"
              }
            },
            "value": "1"
          },
          "CommandList": [
            {
              "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
              "ServerCommandName": "個人フォルダパス取得",
              "ReturnPropertiesTo": [
                {
                  "ResultPropertyName": "R_個人フォルダパス名",
                  "ResultTo": {
                    "SerializeProperty": "個人フォルダパス名"
                  },
                  "Remark": "サーバーのフォルダパスを返却"
                },
                {
                  "ResultPropertyName": "P_個人フォルダ名",
                  "Remark": "ユーザーIDを返却"
                }
              ],
              "RefreshAfterFinish": true,
              "CheckDataValidation": true
            },
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "エクスポートファイルフルパス名",
              "ParameterValue": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=個人フォルダパス名&エクスポートファイル名"
              },
              "ID": "ba7bf751a7094148aa1604c7776cb8a8"
            }
          ],
          "ID": "24f9f835-39d2-4345-822f-0e725412ac9e"
        },
        {
          "CommandList": [
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "環境設定",
              "TableValue": {
                "TableName": "m_environment",
                "TableValueType": 1,
                "BindingInfos": [
                  {
                    "GUID": "bd461c80-701e-4f60-9cf2-a84de8332f6c",
                    "BindingInfo": {
                      "TableName": "m_environment",
                      "ColumnName": "app_name",
                      "GUID": "8c15572e-e779-449a-9bee-19e18811ea6d"
                    },
                    "ColumnName": "アプリ名"
                  },
                  {
                    "GUID": "3dba1bd0-4288-4f54-aa05-1e08d42acd4e",
                    "BindingInfo": {
                      "TableName": "m_environment",
                      "ColumnName": "file_temp_path",
                      "GUID": "3b26548c-f980-4759-b419-a29da39cc951"
                    },
                    "ColumnName": "ファイルTempパス"
                  }
                ],
                "SqlCondition": {
                  "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                  "ColumnBindingInfo": {
                    "TableName": "m_environment",
                    "ColumnName": "ID",
                    "GUID": "722fdb82-150e-420f-b856-79fffd199b42"
                  },
                  "Value": "1"
                }
              },
              "ID": "c09793c02fe143529e15b21ad744b6ea"
            },
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "保存先Tempパス名",
              "ParameterValue": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=環境設定.ファイルTempパス&環境設定.アプリ名&\"\\Temp\\\""
              },
              "ID": "d86ee3be383a477898afacdc2f583c9f"
            },
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "ファイル接頭乱数",
              "ParameterValue": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=TEXT(RANDBETWEEN(0,99999999),\"00000000\")&\"-\"&TEXT(RANDBETWEEN(0,9999),\"0000\")&\"-\"&TEXT(RANDBETWEEN(0,9999),\"0000\")&\"-\"&TEXT(RANDBETWEEN(0,9999),\"0000\")&\"-\"&TEXT(RANDBETWEEN(0,999999999999),\"000000000000\")"
              },
              "ID": "262564fdd28f4f96b24aaf0c52f607c5"
            },
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "Tempファイル名",
              "ParameterValue": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=ファイル接頭乱数&\"_\"&エクスポートファイル名"
              },
              "ID": "4d50a0237d244458a50da39de559b7bb"
            },
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "エクスポートファイルフルパス名",
              "ParameterValue": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=保存先Tempパス名&Tempファイル名"
              },
              "ID": "890204fbfd5a441a9d1141beb0ceecc1"
            }
          ],
          "ID": "30c2a312-a439-4d8e-b39f-17d8d019dab7"
        }
      ]
    },
    {
      "$type": "Forguncy.Model.ExportPageToExcelCommand, ServerDesignerCommon",
      "TargetPageName": "保証確認リスト",
      "ServerExportFileName": {
        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
        "SerializeProperty": "=エクスポートファイルフルパス名"
      },
      "ExportCellValueInfos": [
        {
          "CellName": "対象事業者ID",
          "CellValue": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=P_対象事業者ID"
          }
        },
        {
          "CellName": "対象事業者名",
          "CellValue": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=P_対象事業者名"
          }
        }
      ]
    },
    {
      "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
      "ConditionAndCommandPairList": [
        {
          "Condition": {
            "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
            "param": {
              "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
              "ParamObject": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=P_ダウンロードフラグ"
              }
            },
            "value": "1"
          },
          "CommandList": [
            {
              "$type": "OperateFilesCommand.DownloadFileCommand, OperateFilesCommand",
              "FilePath": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=エクスポートファイルフルパス名&\".xlsx\""
              }
            }
          ],
          "ID": "b27386ef-4276-406a-8504-3af56c2c94d1"
        },
        {
          "CommandList": [
            {
              "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
              "CustomReturns": [
                {
                  "ReturnPropertyName": "R_Tempファイルパス名",
                  "Value": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=Tempファイル名&\".xlsx|\""
                  },
                  "Remark": "ForguncyのTempフォルダに出力されたファイルパス名"
                }
              ]
            }
          ],
          "ID": "d00c5236-bab5-49a6-8373-7e52d1a648b6"
        }
      ]
    }
  ],
  "ReturnProperties": [
    {
      "Name": "R_Tempファイルパス名",
      "Remark": "ForguncyのTempフォルダに出力されたファイルパス名"
    }
  ]
}