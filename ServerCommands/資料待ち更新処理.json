{
  "Name": "資料待ち更新処理",
  "Enabled": true,
  "Triggers": [
    {
      "$type": "Forguncy.SaveLoad.PostRequestTriggerSaveData, ServerDesignerCommon",
      "Permission": {
        "PermissionData": {
          "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionData, Forguncy.RbacPermission.Core",
          "permissionResource": {
            "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionResource, Forguncy.RbacPermission.Core"
          },
          "permissionBindings": [
            {
              "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionBinding, Forguncy.RbacPermission.Core",
              "roleNames": [
                "FGC_LoginUser"
              ]
            }
          ]
        }
      },
      "Parameters": [
        {
          "Name": "P_申込ID",
          "DataValidationInfo": {}
        },
        {
          "Type": 1,
          "ArrayParamItems": [
            {
              "Name": "P_選択フラグ",
              "DataValidationInfo": {}
            },
            {
              "Name": "P_資料待ちID",
              "DataValidationInfo": {}
            },
            {
              "Name": "P_送付予定日",
              "DataValidationInfo": {}
            },
            {
              "Name": "P_送付期日",
              "DataValidationInfo": {}
            }
          ],
          "OnlySendChangedData": true,
          "PrimaryKeys": [
            "資料待ちID"
          ],
          "Name": "P_資料待ちリスト",
          "DataValidationInfo": {}
        },
        {
          "Name": "P_受領済みフラグ",
          "DataValidationInfo": {}
        }
      ]
    }
  ],
  "Commands": [
    {
      "$type": "Forguncy.Model.ServerTransactionCommand, ServerDesignerCommon",
      "CommandList": [
        {
          "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
          "ServerCommandName": "登録更新ラベル取得",
          "ResultErrorCodeTo": {
            "SerializeProperty": "リターンコード"
          },
          "ResultMessageTo": {
            "SerializeProperty": "リターンメッセージ"
          },
          "ReturnPropertiesTo": [
            {
              "ResultPropertyName": "R_ラベル名",
              "ResultTo": {
                "SerializeProperty": "ラベル名"
              }
            }
          ],
          "RefreshAfterFinish": true,
          "CheckDataValidation": true
        },
        {
          "$type": "Forguncy.Model.LoopCommand, ServerDesignerCommon",
          "LoopInfo": {
            "$type": "Forguncy.Model.CountLoopInfo, ServerDesignerCommon",
            "LoopCount": {
              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
              "SerializeProperty": "=P_資料待ちリスト.EditRows"
            },
            "LoopItemParamName": "Item_資料待ち"
          },
          "CommandList": [
            {
              "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
              "ConditionAndCommandPairList": [
                {
                  "Condition": {
                    "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                    "SubConditions": [
                      {
                        "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                        "param": {
                          "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                          "ParamObject": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=Item_資料待ち.P_選択フラグ"
                          }
                        },
                        "value": "1"
                      },
                      {
                        "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                        "param": {
                          "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                          "ParamObject": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=P_受領済みフラグ"
                          }
                        },
                        "value": "1"
                      }
                    ]
                  },
                  "CommandList": [
                    {
                      "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                      "TableName": "t_object_wait_documents",
                      "ShowConfirm": false,
                      "RowsToUpdate": 1,
                      "RowsToUpdateCondition": {
                        "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                        "ColumnBindingInfo": {
                          "TableName": "t_object_wait_documents",
                          "ColumnName": "wait_document_id",
                          "GUID": "a6851524-8dc8-428c-8610-68b82a03b240"
                        },
                        "Value": {
                          "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                          "SerializeProperty": "=Item_資料待ち.P_資料待ちID"
                        }
                      },
                      "UpdateBindingValues": [
                        {
                          "BindingInfo": {
                            "TableName": "t_object_wait_documents",
                            "ColumnName": "receipt_flg",
                            "GUID": "5b7c1ef7-7e6f-44de-9e61-78bbb502077a"
                          },
                          "Value": "1"
                        },
                        {
                          "BindingInfo": {
                            "TableName": "t_object_wait_documents",
                            "ColumnName": "receipt_date",
                            "GUID": "9303b2e9-a5ed-4fd6-97c1-30f566c4bea7"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=NOW()"
                          }
                        },
                        {
                          "BindingInfo": {
                            "TableName": "t_object_wait_documents",
                            "ColumnName": "receipt_user_id",
                            "GUID": "21c5a55d-a2aa-40e7-8d4d-8a1c9b8b069c"
                          },
                          "Value": "%CurrentUser.user_id%"
                        },
                        {
                          "BindingInfo": {
                            "TableName": "t_object_wait_documents",
                            "ColumnName": "last_updated_label",
                            "GUID": "6c1b9429-6618-4373-8a5d-17fe5b84ba8e"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=ラベル名"
                          }
                        }
                      ]
                    }
                  ],
                  "ID": "eab1e868-35be-4f49-bb05-730b52c962dc"
                },
                {
                  "CommandList": [
                    {
                      "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                      "TableName": "t_object_wait_documents",
                      "ShowConfirm": false,
                      "RowsToUpdate": 1,
                      "RowsToUpdateCondition": {
                        "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                        "ColumnBindingInfo": {
                          "TableName": "t_object_wait_documents",
                          "ColumnName": "wait_document_id",
                          "GUID": "b6deaf1a-3baf-4cff-b005-5a6dd2931430"
                        },
                        "Value": {
                          "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                          "SerializeProperty": "=Item_資料待ち.P_資料待ちID"
                        }
                      },
                      "UpdateBindingValues": [
                        {
                          "BindingInfo": {
                            "TableName": "t_object_wait_documents",
                            "ColumnName": "scheduled_sending_date",
                            "GUID": "9f4f5d2d-5a7f-45cc-b357-2b0753c0c473"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=Item_資料待ち.P_送付予定日"
                          }
                        },
                        {
                          "BindingInfo": {
                            "TableName": "t_object_wait_documents",
                            "ColumnName": "send_limite_date",
                            "GUID": "51186c94-2f31-4da8-bc3e-eb1352f369d6"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=Item_資料待ち.P_送付期日"
                          }
                        },
                        {
                          "BindingInfo": {
                            "TableName": "t_object_wait_documents",
                            "ColumnName": "last_updated_label",
                            "GUID": "c215a81b-73d1-4670-8dea-ff2328484bf5"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=ラベル名"
                          }
                        }
                      ]
                    }
                  ],
                  "ID": "ada31d3d-418c-4ca3-ad02-dbd0fa906fd4"
                }
              ]
            }
          ]
        },
        {
          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
          "ParameterName": "資料待ち件数",
          "TableValue": {
            "TableName": "t_object_wait_documents",
            "TableValueType": 3,
            "SqlCondition": {
              "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
              "SubConditions": [
                {
                  "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                  "ColumnBindingInfo": {
                    "TableName": "t_object_wait_documents",
                    "ColumnName": "object_order_id",
                    "GUID": "6352e5fe-0bbb-4aa5-9ab2-43c34b3eb07b"
                  },
                  "Value": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=P_申込ID"
                  }
                },
                {
                  "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                  "ColumnBindingInfo": {
                    "TableName": "t_object_wait_documents",
                    "ColumnName": "receipt_flg",
                    "GUID": "0bdc7410-b43a-4ceb-b9aa-0bdcb25e1147"
                  },
                  "Value": "0"
                }
              ]
            }
          },
          "ID": "0147160082d34c63a5a96fc8b34cd8b4"
        },
        {
          "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
          "ConditionAndCommandPairList": [
            {
              "Condition": {
                "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                "param": {
                  "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                  "ParamObject": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=資料待ち件数"
                  }
                },
                "value": "0"
              },
              "CommandList": [
                {
                  "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                  "TableName": "t_object_order",
                  "ShowConfirm": false,
                  "RowsToUpdate": 1,
                  "RowsToUpdateCondition": {
                    "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                    "ColumnBindingInfo": {
                      "TableName": "t_object_order",
                      "ColumnName": "object_order_id",
                      "GUID": "fc72124f-791c-4ebd-bd8c-aaa035dabe19"
                    },
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=P_申込ID"
                    }
                  },
                  "UpdateBindingValues": [
                    {
                      "BindingInfo": {
                        "TableName": "t_object_order",
                        "ColumnName": "wait_ducoment_flg",
                        "GUID": "768abb53-ec66-42f7-82e5-8a62616c7272"
                      },
                      "Value": "0"
                    },
                    {
                      "BindingInfo": {
                        "TableName": "t_object_order",
                        "ColumnName": "document_wait_count",
                        "GUID": "81e8f931-1b0f-4e4f-ac60-e1cf52152c1e"
                      },
                      "Value": "0"
                    }
                  ]
                }
              ],
              "ID": "e36061df-d4a8-42c2-959c-b885a12a2568"
            },
            {
              "CommandList": [
                {
                  "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                  "TableName": "t_object_order",
                  "ShowConfirm": false,
                  "RowsToUpdate": 1,
                  "RowsToUpdateCondition": {
                    "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                    "ColumnBindingInfo": {
                      "TableName": "t_object_order",
                      "ColumnName": "object_order_id",
                      "GUID": "fadda902-5e55-4b27-b44d-646d07f30347"
                    },
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=P_申込ID"
                    }
                  },
                  "UpdateBindingValues": [
                    {
                      "BindingInfo": {
                        "TableName": "t_object_order",
                        "ColumnName": "document_wait_count",
                        "GUID": "14010d93-3b66-463e-809e-c398106b4a6b"
                      },
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=資料待ち件数"
                      }
                    }
                  ]
                }
              ],
              "ID": "45622057-154d-43b6-b511-e19cff7094d5"
            }
          ],
          "Comments": "資料待ちが無ければ、資料待ちフラグを更新"
        },
        {
          "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
          "ErrorCode": "0"
        }
      ]
    }
  ]
}