{
  "Enabled": true,
  "Triggers": [
    {
      "$type": "Forguncy.ServerCommands.Models.PostRequestTrigger, ServerDesignerCommon",
      "Permission": {
        "AllowRoles": [
          "FGC_LoginUser"
        ]
      },
      "Parameters": [
        {
          "Name": "P_請求先ID"
        },
        {
          "Name": "P_物件ID"
        },
        {
          "Name": "P_請求日"
        }
      ]
    }
  ],
  "Commands": [
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "請求先マスタ",
      "TableValue": {
        "TableName": "m_customer",
        "TableValueType": 1,
        "BindingInfos": [
          {
            "BindingInfo": {
              "TableName": "m_customer",
              "ColumnName": "invoice_issue_unit_id"
            },
            "ColumnName": "請求書発行単位"
          }
        ],
        "SqlCondition": {
          "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
          "ColumnBindingInfo": {
            "TableName": "m_customer",
            "ColumnName": "customer_id"
          },
          "Value": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=P_請求先ID"
          }
        }
      },
      "ID": "a70c9e39bef64e3eb1bdc5667b99a74b"
    },
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "請求年月",
      "ParameterValue": {
        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
        "SerializeProperty": "=TEXT(P_請求日,\"yyyymm\")"
      },
      "ID": "c8e1dc7ba35c4ea2a7baa1ba5b677a95"
    },
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "最終請求連番",
      "ParameterValue": "0",
      "ID": "ff05bfe126f04d00a45a35c426d9d8ef"
    },
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "請求番号",
      "ID": "7daf6bb257934502a8cbf25bd648f846"
    },
    {
      "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
      "ConditionAndCommandPairList": [
        {
          "Condition": {
            "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
            "param": {
              "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
              "ParamObject": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=請求先マスタ.請求書発行単位"
              }
            },
            "value": "1"
          },
          "CommandList": [
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "同一請求件数",
              "TableValue": {
                "TableName": "t_sales",
                "TableValueType": 3,
                "SqlCondition": {
                  "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                  "Condition1": {
                    "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                    "ColumnBindingInfo": {
                      "TableName": "t_sales",
                      "ColumnName": "billing_comp_id"
                    },
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=P_請求先ID"
                    }
                  },
                  "Condition2": {
                    "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                    "ColumnBindingInfo": {
                      "TableName": "t_sales",
                      "ColumnName": "billing_date"
                    },
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=P_請求日"
                    }
                  }
                }
              },
              "ID": "206fcd2218ae4cce8a0a0201926bcb14"
            },
            {
              "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
              "ConditionAndCommandPairList": [
                {
                  "Condition": {
                    "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                    "param": {
                      "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                      "ParamObject": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=同一請求件数"
                      }
                    },
                    "value": "0",
                    "compareType": 2
                  },
                  "CommandList": [
                    {
                      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                      "ParameterName": "請求番号",
                      "TableValue": {
                        "TableName": "t_sales",
                        "OnlyGetValue": true,
                        "TableValueType": 0,
                        "BindingInfos": [
                          {
                            "BindingInfo": {
                              "TableName": "t_sales",
                              "ColumnName": "billing_no"
                            },
                            "ColumnName": "billing_no"
                          }
                        ],
                        "SqlCondition": {
                          "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                          "Condition1": {
                            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                            "ColumnBindingInfo": {
                              "TableName": "t_sales",
                              "ColumnName": "billing_comp_id"
                            },
                            "Value": {
                              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                              "SerializeProperty": "=P_請求先ID"
                            }
                          },
                          "Condition2": {
                            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                            "ColumnBindingInfo": {
                              "TableName": "t_sales",
                              "ColumnName": "billing_date"
                            },
                            "Value": {
                              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                              "SerializeProperty": "=P_請求日"
                            }
                          }
                        },
                        "TopCount": "1",
                        "OrderBySqlCondition": {
                          "OrderByColumns": [
                            {
                              "ColumnBindingInfo": {
                                "TableName": "t_sales",
                                "ColumnName": "billing_no"
                              },
                              "Order": 1
                            }
                          ]
                        }
                      },
                      "ID": "9e24a6dd98e74e0da9ad6169888aac67"
                    }
                  ],
                  "ID": "3432f89f-2365-4074-a471-6f52de6e85de"
                },
                {
                  "CommandList": [
                    {
                      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                      "ParameterName": "請求連番件数",
                      "TableValue": {
                        "TableName": "t_sales",
                        "TableValueType": 3,
                        "SqlCondition": {
                          "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                          "ColumnBindingInfo": {
                            "TableName": "t_sales",
                            "ColumnName": "billing_yyyymm"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=請求年月"
                          }
                        }
                      },
                      "ID": "aad2c80631494f6aacdb4bcd1eafe861"
                    },
                    {
                      "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
                      "ConditionAndCommandPairList": [
                        {
                          "Condition": {
                            "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                            "param": {
                              "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                              "ParamObject": {
                                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                "SerializeProperty": "=請求連番件数"
                              }
                            },
                            "value": "0",
                            "compareType": 2
                          },
                          "CommandList": [
                            {
                              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                              "ParameterName": "最終請求連番",
                              "TableValue": {
                                "TableName": "t_sales",
                                "OnlyGetValue": true,
                                "TableValueType": 0,
                                "BindingInfos": [
                                  {
                                    "BindingInfo": {
                                      "TableName": "t_sales",
                                      "ColumnName": "billing_serial_number"
                                    },
                                    "ColumnName": "billing_serial_number"
                                  }
                                ],
                                "SqlCondition": {
                                  "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                                  "ColumnBindingInfo": {
                                    "TableName": "t_sales",
                                    "ColumnName": "billing_yyyymm"
                                  },
                                  "Value": {
                                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                    "SerializeProperty": "=請求年月"
                                  }
                                },
                                "TopCount": "1",
                                "OrderBySqlCondition": {
                                  "OrderByColumns": [
                                    {
                                      "ColumnBindingInfo": {
                                        "TableName": "t_sales",
                                        "ColumnName": "billing_no"
                                      },
                                      "Order": 1
                                    }
                                  ]
                                }
                              },
                              "ID": "f5cb85783d28489a8941c59ec5b4aa4b"
                            }
                          ],
                          "ID": "5f1ea2b8-3932-4eb9-8585-46db9c4ed96b"
                        }
                      ]
                    }
                  ],
                  "ID": "51c290d3-0253-4e3f-9480-74b1a15371d1"
                }
              ]
            }
          ],
          "ID": "b8db031a-4e51-4a6d-baf2-8beaf4361d17"
        },
        {
          "CommandList": [
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "同一請求件数",
              "TableValue": {
                "TableName": "t_sales",
                "TableValueType": 3,
                "SqlCondition": {
                  "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                  "Condition1": {
                    "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                    "Condition1": {
                      "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                      "ColumnBindingInfo": {
                        "TableName": "t_sales",
                        "ColumnName": "billing_comp_id"
                      },
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=P_請求先ID"
                      }
                    },
                    "Condition2": {
                      "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                      "ColumnBindingInfo": {
                        "TableName": "t_sales",
                        "ColumnName": "billing_date"
                      },
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=P_請求日"
                      }
                    }
                  },
                  "Condition2": {
                    "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                    "ColumnBindingInfo": {
                      "TableName": "t_sales",
                      "ColumnName": "object_order_id",
                      "RelationBinding": {
                        "RelatedTable": "t_object_order",
                        "RelatedColumn": "object_order_id",
                        "DisplayColumn": "object_id"
                      }
                    },
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=P_物件ID"
                    }
                  }
                }
              },
              "ID": "7e6cc8a0e18f4f7e8b5d639d89e8c5fc"
            },
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "最終請求連番",
              "ParameterValue": "0",
              "ID": "3a8344cd5bdd4f38ba8cde8aaa952cb3"
            },
            {
              "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
              "ConditionAndCommandPairList": [
                {
                  "Condition": {
                    "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                    "param": {
                      "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                      "ParamObject": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=同一請求件数"
                      }
                    },
                    "value": "0",
                    "compareType": 2
                  },
                  "CommandList": [
                    {
                      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                      "ParameterName": "請求番号",
                      "TableValue": {
                        "TableName": "t_sales",
                        "OnlyGetValue": true,
                        "TableValueType": 0,
                        "BindingInfos": [
                          {
                            "BindingInfo": {
                              "TableName": "t_sales",
                              "ColumnName": "billing_no"
                            },
                            "ColumnName": "billing_no"
                          }
                        ],
                        "SqlCondition": {
                          "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                          "Condition1": {
                            "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                            "Condition1": {
                              "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                              "ColumnBindingInfo": {
                                "TableName": "t_sales",
                                "ColumnName": "billing_comp_id"
                              },
                              "Value": {
                                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                "SerializeProperty": "=P_請求先ID"
                              }
                            },
                            "Condition2": {
                              "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                              "ColumnBindingInfo": {
                                "TableName": "t_sales",
                                "ColumnName": "billing_date"
                              },
                              "Value": {
                                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                "SerializeProperty": "=P_請求日"
                              }
                            }
                          },
                          "Condition2": {
                            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                            "ColumnBindingInfo": {
                              "TableName": "t_sales",
                              "ColumnName": "object_order_id",
                              "RelationBinding": {
                                "RelatedTable": "t_object_order",
                                "RelatedColumn": "object_order_id",
                                "DisplayColumn": "object_id"
                              }
                            },
                            "Value": {
                              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                              "SerializeProperty": "=P_物件ID"
                            }
                          }
                        },
                        "TopCount": "1",
                        "OrderBySqlCondition": {
                          "OrderByColumns": [
                            {
                              "ColumnBindingInfo": {
                                "TableName": "t_sales",
                                "ColumnName": "billing_no"
                              },
                              "Order": 1
                            }
                          ]
                        }
                      },
                      "ID": "9aa3ba9c70014ab6ac4aa0375133418d"
                    }
                  ],
                  "ID": "b38c0379-fc6d-417c-851d-4cb67536a46a"
                },
                {
                  "CommandList": [
                    {
                      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                      "ParameterName": "請求連番件数",
                      "TableValue": {
                        "TableName": "t_sales",
                        "TableValueType": 3,
                        "SqlCondition": {
                          "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                          "ColumnBindingInfo": {
                            "TableName": "t_sales",
                            "ColumnName": "billing_yyyymm"
                          },
                          "Value": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=請求年月"
                          }
                        }
                      },
                      "ID": "3e398779d5a9495b9ba744cedd9d0202"
                    },
                    {
                      "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
                      "ConditionAndCommandPairList": [
                        {
                          "Condition": {
                            "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                            "param": {
                              "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                              "ParamObject": {
                                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                "SerializeProperty": "=請求連番件数"
                              }
                            },
                            "value": "0",
                            "compareType": 2
                          },
                          "CommandList": [
                            {
                              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                              "ParameterName": "最終請求連番",
                              "TableValue": {
                                "TableName": "t_sales",
                                "OnlyGetValue": true,
                                "TableValueType": 0,
                                "BindingInfos": [
                                  {
                                    "BindingInfo": {
                                      "TableName": "t_sales",
                                      "ColumnName": "billing_serial_number"
                                    },
                                    "ColumnName": "billing_serial_number"
                                  }
                                ],
                                "SqlCondition": {
                                  "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                                  "ColumnBindingInfo": {
                                    "TableName": "t_sales",
                                    "ColumnName": "billing_yyyymm"
                                  },
                                  "Value": {
                                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                                    "SerializeProperty": "=請求年月"
                                  }
                                },
                                "TopCount": "1",
                                "OrderBySqlCondition": {
                                  "OrderByColumns": [
                                    {
                                      "ColumnBindingInfo": {
                                        "TableName": "t_sales",
                                        "ColumnName": "billing_serial_number"
                                      },
                                      "Order": 1
                                    }
                                  ]
                                }
                              },
                              "ID": "9c828b628ce3478aa42f057ae9a8a175"
                            }
                          ],
                          "ID": "5ff00ae7-362e-4951-a0bf-edee3642ed35"
                        }
                      ]
                    }
                  ],
                  "ID": "6f0a789f-4c3c-4fb7-ad4b-28e56a9cd93f"
                }
              ]
            }
          ],
          "ID": "33945ea0-b7f2-4b1d-8b7f-692ef8c279e5"
        }
      ],
      "Comments": "請求番号取得"
    },
    {
      "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
      "ConditionAndCommandPairList": [
        {
          "Condition": {
            "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
            "param": {
              "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
              "ParamObject": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=請求番号"
              }
            },
            "value": "%Null%"
          },
          "CommandList": [
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "新規請求連番",
              "ParameterValue": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=最終請求連番+1"
              },
              "ID": "3ffb0f9736384a6bafc536bde9984448"
            },
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "請求番号",
              "ParameterValue": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=\"MC\"&請求年月&TEXT(新規請求連番,\"000\")"
              },
              "ID": "6ba7faaafc8644b4a980f11968ae3789"
            }
          ],
          "ID": "95f5ee13-4695-4490-a25b-accbeb80efd4"
        },
        {
          "CommandList": [
            {
              "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
              "ParameterName": "新規請求連番",
              "ParameterValue": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=VALUE(RIGHT(請求番号,3))"
              },
              "ID": "4654c273c0c743dc82eb3e4687ae8b2e"
            }
          ],
          "ID": "b16f393a-8d04-41b8-b487-00687186f949"
        }
      ]
    },
    {
      "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
      "ErrorCode": "0",
      "CustomReturns": [
        {
          "ReturnPropertyName": "R_請求番号",
          "Value": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=請求番号"
          }
        },
        {
          "ReturnPropertyName": "R_請求連番",
          "Value": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=新規請求連番"
          }
        }
      ]
    }
  ],
  "ReturnProperties": [
    {
      "Name": "R_請求番号"
    },
    {
      "Name": "R_請求連番"
    }
  ],
  "Name": "請求番号取得"
}