{
  "Name": "請求書PDFファイル作成処理",
  "Enabled": true,
  "Triggers": [
    {
      "$type": "Forguncy.SaveLoad.PostRequestTriggerSaveData, ServerDesignerCommon",
      "Permission": {
        "PermissionData": {
          "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionData, Forguncy.RbacPermission.Core",
          "permissionResource": {
            "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionResource, Forguncy.RbacPermission.Core"
          },
          "permissionBindings": [
            {
              "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionBinding, Forguncy.RbacPermission.Core",
              "roleNames": [
                "FGC_LoginUser"
              ]
            }
          ]
        }
      },
      "Parameters": [
        {
          "Type": 1,
          "ArrayParamItems": [
            {
              "Name": "P_選択フラグ",
              "DataValidationInfo": {}
            },
            {
              "Name": "P_請求番号",
              "DataValidationInfo": {}
            },
            {
              "Name": "P_請求先名",
              "DataValidationInfo": {}
            }
          ],
          "Name": "P_請求書リスト",
          "DataValidationInfo": {}
        }
      ]
    }
  ],
  "Commands": [
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "保存先サーバーパス名",
      "ParameterValue": {
        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
        "SerializeProperty": "=Private_Server_Path"
      },
      "ID": "43032b3ceecb40a1b68dd957a2820da3"
    },
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "個人フォルダ名",
      "ParameterValue": "%CurrentUser.user_id%",
      "ID": "36098e43c67c4e4d92a62e3c59346977"
    },
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "個人フォルダフルパス名",
      "ParameterValue": {
        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
        "SerializeProperty": "=保存先サーバーパス名&個人フォルダ名&\"\\\""
      },
      "ID": "f8b9cc66cb5a42468a70e2d7bf8975b4"
    },
    {
      "$type": "OperateFilesCommand.CreateFolderCommand, OperateFilesCommand",
      "FolderPath": {
        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
        "SerializeProperty": "=個人フォルダフルパス名"
      },
      "Comments": "個人フォルダ作成"
    },
    {
      "$type": "Forguncy.Model.LoopCommand, ServerDesignerCommon",
      "LoopInfo": {
        "$type": "Forguncy.Model.CountLoopInfo, ServerDesignerCommon",
        "LoopCount": {
          "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
          "SerializeProperty": "=P_請求書リスト"
        },
        "LoopItemParamName": "Item"
      },
      "CommandList": [
        {
          "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
          "ConditionAndCommandPairList": [
            {
              "Condition": {
                "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                "param": {
                  "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                  "ParamObject": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=Item.P_選択フラグ"
                  }
                },
                "value": "1"
              },
              "CommandList": [
                {
                  "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                  "ParameterName": "変換請求先名",
                  "ParameterValue": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=SUBSTITUTE(Item.P_請求先名,\":\",\"：\")"
                  },
                  "ID": "a35ea761f02043888e6628c891df5ff4"
                },
                {
                  "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
                  "ServerCommandName": "ファイル名文字列変換",
                  "Parameters": [
                    {
                      "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
                      "ParamName": "P_変換元文字列",
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=Item.P_請求先名"
                      }
                    }
                  ],
                  "ReturnPropertiesTo": [
                    {
                      "ResultPropertyName": "R_変換後文字列",
                      "ResultTo": {
                        "SerializeProperty": "変換請求先名"
                      }
                    }
                  ],
                  "RefreshAfterFinish": true,
                  "CheckDataValidation": true,
                  "Comments": "文字列でファイル名に使えない文字を調整する"
                },
                {
                  "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                  "ParameterName": "出力ファイルパス名",
                  "ParameterValue": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=個人フォルダフルパス名&Item.P_請求番号&\"_\"&変換請求先名&\"様.pdf\""
                  },
                  "ID": "d783f7f830a244588eae840bd8e7ded1"
                },
                {
                  "$type": "Forguncy.Model.ExportActiveReportCommand, ServerDesignerCommon",
                  "ExportReportNameList": [
                    "請求書"
                  ],
                  "CustomName": "請求書",
                  "ServerExportFileName": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=出力ファイルパス名"
                  },
                  "ExportSettings": {
                    "MultiSheet": true
                  },
                  "PassParameters": [
                    {
                      "TargetParameter": "P_請求番号",
                      "SourceValue": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=Item.P_請求番号"
                      }
                    }
                  ],
                  "IsPageBreakBefores": [
                    false
                  ],
                  "ReportGaps": [
                    "0cm"
                  ]
                }
              ],
              "ID": "ef169300-dd29-4bd6-805e-a2e9fb7d9ebd"
            }
          ]
        }
      ]
    }
  ]
}