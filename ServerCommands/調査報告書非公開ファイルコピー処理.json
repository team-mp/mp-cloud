{
  "Name": "調査報告書非公開ファイルコピー処理",
  "Enabled": true,
  "Triggers": [
    {
      "$type": "Forguncy.SaveLoad.PostRequestTriggerSaveData, ServerDesignerCommon",
      "Permission": {
        "PermissionData": {
          "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionData, Forguncy.RbacPermission.Core",
          "permissionResource": {
            "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionResource, Forguncy.RbacPermission.Core"
          },
          "permissionBindings": [
            {
              "$type": "Forguncy.RbacPermission.Core.Impl.ServerCommand.ServerCommandPermissionBinding, Forguncy.RbacPermission.Core",
              "roleNames": [
                "FGC_LoginUser"
              ]
            }
          ]
        }
      },
      "Parameters": [
        {
          "Name": "P_添付IDs",
          "DataValidationInfo": {}
        },
        {
          "Name": "P_解析ID",
          "DataValidationInfo": {}
        }
      ]
    }
  ],
  "Commands": [
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "環境設定",
      "TableValue": {
        "TableName": "m_environment",
        "TableValueType": 1,
        "BindingInfos": [
          {
            "GUID": "26069df8-ebdc-4d8c-b567-73d356582bae",
            "BindingInfo": {
              "TableName": "m_environment",
              "ColumnName": "app_name",
              "GUID": "29a80c37-7d2d-4f79-b95f-32c9f1629478"
            },
            "ColumnName": "アプリ名"
          },
          {
            "GUID": "5201ebaf-b597-4040-aacf-de13a425d881",
            "BindingInfo": {
              "TableName": "m_environment",
              "ColumnName": "file_temp_path",
              "GUID": "6c663bec-300a-42fe-9350-95d13d89bb51"
            },
            "ColumnName": "ファイルTempパス"
          }
        ],
        "SqlCondition": {
          "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
          "ColumnBindingInfo": {
            "TableName": "m_environment",
            "ColumnName": "ID",
            "GUID": "956328c5-4ee1-4b84-be08-349678368f6a"
          },
          "Value": "1"
        }
      },
      "ID": "1c0b9cd4b78d4d22a69d7959fc620759"
    },
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "保存先Tempパス名",
      "ParameterValue": {
        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
        "SerializeProperty": "=環境設定.ファイルTempパス&環境設定.アプリ名&\"\\Temp\\\""
      },
      "ID": "64970453daac46d48bbf5741714ddd35"
    },
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "添付情報",
      "TableValue": {
        "TableName": "t_object_attachment",
        "BindingInfos": [
          {
            "GUID": "a8fd4cd9-b93b-4c61-a9d1-bda107f2b3c6",
            "BindingInfo": {
              "TableName": "t_object_attachment",
              "ColumnName": "attachment_id",
              "GUID": "96e67ba3-480e-4173-a3f9-5084e42ade2f"
            },
            "ColumnName": "添付ID"
          },
          {
            "GUID": "f585889e-937b-4c09-835e-d2ca5c70923f",
            "BindingInfo": {
              "TableName": "t_object_attachment",
              "ColumnName": "object_id",
              "GUID": "4c96a715-761d-440f-a874-e5883a11abb4"
            },
            "ColumnName": "物件ID"
          },
          {
            "GUID": "e83c2f63-7dac-4f32-8be8-c757d8c134bc",
            "BindingInfo": {
              "TableName": "t_object_attachment",
              "ColumnName": "object_order_id",
              "GUID": "33cfd850-9597-4b7c-9bc2-f86a1aa8105f"
            },
            "ColumnName": "申込ID"
          },
          {
            "GUID": "925e6e5e-16e0-40df-ad6c-0d5a858e3863",
            "BindingInfo": {
              "TableName": "t_object_attachment",
              "ColumnName": "file_attribute_id",
              "GUID": "774b3f4a-e57e-4ffb-852b-1025c75fd258"
            },
            "ColumnName": "ファイル属性ID"
          },
          {
            "GUID": "bc18a810-540f-4cd8-9682-3e91daa03f49",
            "BindingInfo": {
              "TableName": "t_object_attachment",
              "ColumnName": "display_file_name",
              "GUID": "f6321372-e7a7-44cb-acae-f663c4253eb2"
            },
            "ColumnName": "表示ファイル名"
          },
          {
            "GUID": "b3f7b46d-a0fc-4a1e-a731-f857b0117c8e",
            "BindingInfo": {
              "TableName": "t_object_attachment",
              "ColumnName": "file_path_name",
              "GUID": "b6abdc3b-e54f-4284-a3e1-f69d16f2103e"
            },
            "ColumnName": "ファイルパス名"
          },
          {
            "GUID": "409a5e26-2163-4d97-8c36-d3327bc4ecc6",
            "BindingInfo": {
              "TableName": "t_object_attachment",
              "ColumnName": "save_file_name",
              "GUID": "a49b6048-a03b-4d11-95fd-3dd710d9a40a"
            },
            "ColumnName": "保存ファイル名"
          },
          {
            "GUID": "736ef923-18e1-4422-8978-5dc30c1794d9",
            "BindingInfo": {
              "TableName": "t_object_attachment",
              "ColumnName": "publish_flg",
              "GUID": "a431b768-a19f-4791-91e1-e66710a2a5da"
            },
            "ColumnName": "公開フラグ"
          },
          {
            "GUID": "5894abf1-66a5-4a2d-a231-50da4c14d8c9",
            "BindingInfo": {
              "TableName": "t_object_attachment",
              "ColumnName": "no_attachment_required_flg",
              "GUID": "89a6c78d-86a4-408e-b48a-a8a5184daa11"
            },
            "ColumnName": "添付不要フラグ"
          }
        ],
        "SqlCondition": {
          "$type": "ForguncyDataAccess.TextCESqlCondition, ForguncyDataAccess",
          "CompareType": 8,
          "ColumnBindingInfo": {
            "TableName": "t_object_attachment",
            "ColumnName": "attachment_id",
            "GUID": "4653f3ba-1970-4603-bc69-b92cc11471b8"
          },
          "Value": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=P_添付IDs"
          }
        }
      },
      "ID": "a8ee1f7d2abb49cba67d839625db8db1"
    },
    {
      "$type": "Forguncy.Model.LoopCommand, ServerDesignerCommon",
      "LoopInfo": {
        "$type": "Forguncy.Model.CountLoopInfo, ServerDesignerCommon",
        "LoopCount": {
          "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
          "SerializeProperty": "=添付情報"
        },
        "LoopItemParamName": "Item"
      },
      "CommandList": [
        {
          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
          "ParameterName": "保存元ファイルパス名",
          "ParameterValue": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=Item.ファイルパス名&Item.保存ファイル名"
          },
          "ID": "69f51067fa5443ba93c076adcca04731"
        },
        {
          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
          "ParameterName": "ファイル接頭乱数",
          "ParameterValue": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=TEXT(RANDBETWEEN(0,99999999),\"00000000\")&\"-\"&TEXT(RANDBETWEEN(0,9999),\"0000\")&\"-\"&TEXT(RANDBETWEEN(0,9999),\"0000\")&\"-\"&TEXT(RANDBETWEEN(0,9999),\"0000\")&\"-\"&TEXT(RANDBETWEEN(0,999999999999),\"000000000000\")"
          },
          "ID": "0d57e5c3421d4f42a961ba37aff272b0"
        },
        {
          "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
          "ParameterName": "Tempファイル名",
          "ParameterValue": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=ファイル接頭乱数&\"_\"&Item.表示ファイル名"
          },
          "ID": "45c5964098f0474d8e706ab909033bf5"
        },
        {
          "$type": "OperateFilesCommand.CopyFileCommand, OperateFilesCommand",
          "FilePath": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=保存元ファイルパス名"
          },
          "TargetFolderPath": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=保存先Tempパス名"
          },
          "CopyFileName": {
            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
            "SerializeProperty": "=Tempファイル名"
          }
        },
        {
          "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
          "ServerCommandName": "ファイルアップロード処理",
          "Parameters": [
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_申込ID",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=Item.申込ID"
              }
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_物件IDs",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=Item.物件ID"
              }
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_ファイル属性ID",
              "Value": "20"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_コメント"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_添付ファイル",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=Tempファイル名&\"|\""
              }
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_変換ファイル",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=Tempファイル名&\"|\""
              },
              "Remark": "NFKC正規化用のファイル名 "
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_調査ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_測量ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_解析ID",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=P_解析ID"
              }
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_転圧ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_工事見積ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_工事ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_保証ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_付保ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_外販ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_物件商品ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_連絡ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_調査実施日"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_敷測実施日"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_役調実施日"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_転圧設計図区分"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_転圧実施開始日"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_転圧実施終了日"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_工事会社ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_工事工法ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_工事報告者区分"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_工事実施開始日"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_工事実施終了日"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_工事見積工法ID"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_資料待ちIDs",
              "Remark": "受療済みに更新する"
            },
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "ParamName": "P_公開フラグ",
              "Value": "0"
            }
          ],
          "ReturnPropertiesTo": [
            {
              "ResultPropertyName": "R_ファイル名文字列"
            }
          ],
          "RefreshAfterFinish": true,
          "CheckDataValidation": true
        }
      ]
    }
  ]
}